(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{629:function(e,l,c){"use strict";c.r(l);var a=c(1),t=Object(a.a)({},(function(){var e=this,l=e.$createElement,c=e._self._c||l;return c("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[c("h1",{attrs:{id:"adr-038-kvstore-state-listening"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#adr-038-kvstore-state-listening"}},[e._v("#")]),e._v(" ADR 038: KVStore state listening")]),e._v(" "),c("h2",{attrs:{id:"changelog"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#changelog"}},[e._v("#")]),e._v(" Changelog")]),e._v(" "),c("ul",[c("li",[e._v("11/23/2020: Initial draft")])]),e._v(" "),c("h2",{attrs:{id:"status"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#status"}},[e._v("#")]),e._v(" Status")]),e._v(" "),c("p",[e._v("Proposed")]),e._v(" "),c("h2",{attrs:{id:"abstract"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),c("p",[e._v("This ADR defines a set of changes to enable listening to state changes of individual KVStores and exposing these data to consumers.")]),e._v(" "),c("h2",{attrs:{id:"context"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[e._v("#")]),e._v(" Context")]),e._v(" "),c("p",[e._v("Currently, KVStore data can be remotely accessed through "),c("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/master/docs/building-modules/messages-and-queries.md#queries",target:"_blank",rel:"noopener noreferrer"}},[e._v("Queries"),c("OutboundLink")],1),e._v("\nwhich proceed either through Tendermint and the ABCI, or through the gRPC server.\nIn addition to these request/response queries, it would be beneficial to have a means of listening to state changes as they occur in real time.")]),e._v(" "),c("h2",{attrs:{id:"decision"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#decision"}},[e._v("#")]),e._v(" Decision")]),e._v(" "),c("p",[e._v("We will modify the "),c("code",[e._v("MultiStore")]),e._v(" interface and its concrete ("),c("code",[e._v("rootmulti")]),e._v(" and "),c("code",[e._v("cachemulti")]),e._v(") implementations and introduce a new "),c("code",[e._v("listenkv.Store")]),e._v(" to allow listening to state changes in underlying KVStores.\nWe will also introduce the tooling for writing these state changes out to files and configuring this service.")]),e._v(" "),c("h3",{attrs:{id:"listening-interface"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#listening-interface"}},[e._v("#")]),e._v(" Listening interface")]),e._v(" "),c("p",[e._v("In a new file, "),c("code",[e._v("store/types/listening.go")]),e._v(", we will create a "),c("code",[e._v("WriteListener")]),e._v(" interface for streaming out state changes from a KVStore.")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gV3JpdGVMaXN0ZW5lciBpbnRlcmZhY2UgZm9yIHN0cmVhbWluZyBkYXRhIG91dCBmcm9tIGEgbGlzdGVua3YuU3RvcmUKdHlwZSBXcml0ZUxpc3RlbmVyIGludGVyZmFjZSB7CgkvLyBpZiB2YWx1ZSBpcyBuaWwgdGhlbiBpdCB3YXMgZGVsZXRlZAoJLy8gc3RvcmVLZXkgaW5kaWNhdGVzIHRoZSBzb3VyY2UgS1ZTdG9yZSwgdG8gZmFjaWxpdGF0ZSB1c2luZyB0aGUgdGhlIHNhbWUgV3JpdGVMaXN0ZW5lciBhY3Jvc3Mgc2VwYXJhdGUgS1ZTdG9yZXMKCS8vIGRlbGV0ZSBib29sIGluZGljYXRlcyBpZiBpdCB3YXMgYSBkZWxldGU7IHRydWU6IGRlbGV0ZSwgZmFsc2U6IHNldAogICAgT25Xcml0ZShzdG9yZUtleSBTdG9yZUtleSwga2V5IFtdYnl0ZSwgdmFsdWUgW11ieXRlLCBkZWxldGUgYm9vbCkgZXJyb3IKfQo="}}),e._v(" "),c("h3",{attrs:{id:"listener-type"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#listener-type"}},[e._v("#")]),e._v(" Listener type")]),e._v(" "),c("p",[e._v("We will create a concrete implementation of the "),c("code",[e._v("WriteListener")]),e._v(" interface in "),c("code",[e._v("store/types/listening.go")]),e._v(", that writes out protobuf\nencoded KV pairs to an underlying "),c("code",[e._v("io.Writer")]),e._v(".")]),e._v(" "),c("p",[e._v("This will include defining a simple protobuf type for the KV pairs. In addition to the key and value fields this message\nwill include the StoreKey for the originating KVStore so that we can write out from separate KVStores to the same stream/file\nand determine the source of each KV pair.")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBTdG9yZUtWUGFpciB7CiAgb3B0aW9uYWwgc3RyaW5nIHN0b3JlX2tleSA9IDE7IC8vIHRoZSBzdG9yZSBrZXkgZm9yIHRoZSBLVlN0b3JlIHRoaXMgcGFpciBvcmlnaW5hdGVzIGZyb20KICByZXF1aXJlZCBib29sIHNldCA9IDI7IC8vIHRydWUgaW5kaWNhdGVzIGEgc2V0IG9wZXJhdGlvbiwgZmFsc2UgaW5kaWNhdGVzIGEgZGVsZXRlIG9wZXJhdGlvbgogIHJlcXVpcmVkIGJ5dGVzIGtleSA9IDM7CiAgcmVxdWlyZWQgYnl0ZXMgdmFsdWUgPSA0Owp9Cg=="}}),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gU3RvcmVLVlBhaXJXcml0ZUxpc3RlbmVyIGlzIHVzZWQgdG8gY29uZmlndXJlIGxpc3RlbmluZyB0byBhIEtWU3RvcmUgYnkgd3JpdGluZyBvdXQgbGVuZ3RoLXByZWZpeGVkCi8vIHByb3RvYnVmIGVuY29kZWQgU3RvcmVLVlBhaXJzIHRvIGFuIHVuZGVybHlpbmcgaW8uV3JpdGVyCnR5cGUgU3RvcmVLVlBhaXJXcml0ZUxpc3RlbmVyIHN0cnVjdCB7Cgl3cml0ZXIgaW8uV3JpdGVyCgltYXJzaGFsbGVyIGNvZGVjLkJpbmFyeUNvZGVjCn0KCi8vIE5ld1N0b3JlS1ZQYWlyV3JpdGVMaXN0ZW5lciB3cmFwcyBjcmVhdGVzIGEgU3RvcmVLVlBhaXJXcml0ZUxpc3RlbmVyIHdpdGggYSBwcm92ZGllZCBpby5Xcml0ZXIgYW5kIGNvZGVjLkJpbmFyeUNvZGVjCmZ1bmMgTmV3U3RvcmVLVlBhaXJXcml0ZUxpc3RlbmVyKHcgaW8uV3JpdGVyLCBtIGNvZGVjLkJpbmFyeUNvZGVjKSAqU3RvcmVLVlBhaXJXcml0ZUxpc3RlbmVyIHsKCXJldHVybiAmYW1wO1N0b3JlS1ZQYWlyV3JpdGVMaXN0ZW5lcnsKCQl3cml0ZXI6IHcsCgkJbWFyc2hhbGxlcjogbSwKCX0KfQoKLy8gT25Xcml0ZSBzYXRpc2ZpZXMgdGhlIFdyaXRlTGlzdGVuZXIgaW50ZXJmYWNlIGJ5IHdyaXRpbmcgbGVuZ3RoLXByZWZpeGVkIHByb3RvYnVmIGVuY29kZWQgU3RvcmVLVlBhaXJzCmZ1bmMgKHdsICpTdG9yZUtWUGFpcldyaXRlTGlzdGVuZXIpIE9uV3JpdGUoc3RvcmVLZXkgdHlwZXMuU3RvcmVLZXksIGtleSBbXWJ5dGUsIHZhbHVlIFtdYnl0ZSwgZGVsZXRlIGJvb2wpIGVycm9yIGVycm9yIHsKCWt2UGFpciA6PSBuZXcodHlwZXMuU3RvcmVLVlBhaXIpCglrdlBhaXIuU3RvcmVLZXkgPSBzdG9yZUtleS5OYW1lKCkKCWt2UGFpci5EZWxldGUgPSBEZWxldGUKCWt2UGFpci5LZXkgPSBrZXkKCWt2UGFpci5WYWx1ZSA9IHZhbHVlCglieSwgZXJyIDo9IHdsLm1hcnNoYWxsZXIuTWFyc2hhbEJpbmFyeUxlbmd0aFByZWZpeGVkKGt2UGFpcikKCWlmIGVyciAhPSBuaWwgewogICAgICAgICAgICAgICAgcmV0dXJuIGVycgoJfQogICAgICAgIGlmIF8sIGVyciA6PSB3bC53cml0ZXIuV3JpdGUoYnkpOyBlcnIgIT0gbmlsIHsKICAgICAgICAJcmV0dXJuIGVycgogICAgICAgIH0KICAgICAgICByZXR1cm4gbmlsCn0K"}}),e._v(" "),c("h3",{attrs:{id:"listenkvstore"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#listenkvstore"}},[e._v("#")]),e._v(" ListenKVStore")]),e._v(" "),c("p",[e._v("We will create a new "),c("code",[e._v("Store")]),e._v(" type "),c("code",[e._v("listenkv.Store")]),e._v(" that the "),c("code",[e._v("MultiStore")]),e._v(" wraps around a "),c("code",[e._v("KVStore")]),e._v(" to enable state listening.\nWe can configure the "),c("code",[e._v("Store")]),e._v(" with a set of "),c("code",[e._v("WriteListener")]),e._v("s which stream the output to specific destinations.")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gU3RvcmUgaW1wbGVtZW50cyB0aGUgS1ZTdG9yZSBpbnRlcmZhY2Ugd2l0aCBsaXN0ZW5pbmcgZW5hYmxlZC4KLy8gT3BlcmF0aW9ucyBhcmUgdHJhY2VkIG9uIGVhY2ggY29yZSBLVlN0b3JlIGNhbGwgYW5kIHdyaXR0ZW4gdG8gYW55IG9mIHRoZQovLyB1bmRlcmx5aW5nIGxpc3RlbmVycyB3aXRoIHRoZSBwcm9wZXIga2V5IGFuZCBvcGVyYXRpb24gcGVybWlzc2lvbnMKdHlwZSBTdG9yZSBzdHJ1Y3QgewoJcGFyZW50ICAgIHR5cGVzLktWU3RvcmUKCWxpc3RlbmVycyBbXXR5cGVzLldyaXRlTGlzdGVuZXIKCXBhcmVudFN0b3JlS2V5IHR5cGVzLlN0b3JlS2V5Cn0KCi8vIE5ld1N0b3JlIHJldHVybnMgYSByZWZlcmVuY2UgdG8gYSBuZXcgdHJhY2VLVlN0b3JlIGdpdmVuIGEgcGFyZW50Ci8vIEtWU3RvcmUgaW1wbGVtZW50YXRpb24gYW5kIGEgYnVmZmVyZWQgd3JpdGVyLgpmdW5jIE5ld1N0b3JlKHBhcmVudCB0eXBlcy5LVlN0b3JlLCBwc2sgdHlwZXMuU3RvcmVLZXksIGxpc3RlbmVycyBbXXR5cGVzLldyaXRlTGlzdGVuZXIpICpTdG9yZSB7CglyZXR1cm4gJmFtcDtTdG9yZXtwYXJlbnQ6IHBhcmVudCwgbGlzdGVuZXJzOiBsaXN0ZW5lcnMsIHBhcmVudFN0b3JlS2V5OiBwc2t9Cn0KCi8vIFNldCBpbXBsZW1lbnRzIHRoZSBLVlN0b3JlIGludGVyZmFjZS4gSXQgdHJhY2VzIGEgd3JpdGUgb3BlcmF0aW9uIGFuZAovLyBkZWxlZ2F0ZXMgdGhlIFNldCBjYWxsIHRvIHRoZSBwYXJlbnQgS1ZTdG9yZS4KZnVuYyAocyAqU3RvcmUpIFNldChrZXkgW11ieXRlLCB2YWx1ZSBbXWJ5dGUpIHsKCXR5cGVzLkFzc2VydFZhbGlkS2V5KGtleSkKCXMucGFyZW50LlNldChrZXksIHZhbHVlKQoJcy5vbldyaXRlKGZhbHNlLCBrZXksIHZhbHVlKQp9CgovLyBEZWxldGUgaW1wbGVtZW50cyB0aGUgS1ZTdG9yZSBpbnRlcmZhY2UuIEl0IHRyYWNlcyBhIHdyaXRlIG9wZXJhdGlvbiBhbmQKLy8gZGVsZWdhdGVzIHRoZSBEZWxldGUgY2FsbCB0byB0aGUgcGFyZW50IEtWU3RvcmUuCmZ1bmMgKHMgKlN0b3JlKSBEZWxldGUoa2V5IFtdYnl0ZSkgewoJcy5wYXJlbnQuRGVsZXRlKGtleSkKCXMub25Xcml0ZSh0cnVlLCBrZXksIG5pbCkKfQoKLy8gb25Xcml0ZSB3cml0ZXMgYSBLVlN0b3JlIG9wZXJhdGlvbiB0byBhbGwgb2YgdGhlIFdyaXRlTGlzdGVuZXJzCmZ1bmMgKHMgKlN0b3JlKSBvbldyaXRlKGRlbGV0ZSBib29sLCBrZXksIHZhbHVlIFtdYnl0ZSkgewoJZm9yIF8sIGwgOj0gcmFuZ2Ugcy5saXN0ZW5lcnMgewoJCWlmIGVyciA6PSBsLk9uV3JpdGUocy5wYXJlbnRTdG9yZUtleSwga2V5LCB2YWx1ZSwgZGVsZXRlKTsgZXJyICE9IG5pbCB7CiAgICAgICAgICAgICAgICAgICAgLy8gbG9nIGVycm9yCiAgICAgICAgICAgICAgICB9Cgl9Cn0K"}}),e._v(" "),c("h3",{attrs:{id:"multistore-interface-updates"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#multistore-interface-updates"}},[e._v("#")]),e._v(" MultiStore interface updates")]),e._v(" "),c("p",[e._v("We will update the "),c("code",[e._v("MultiStore")]),e._v(" interface to allow us to wrap a set of listeners around a specific "),c("code",[e._v("KVStore")]),e._v(".\nAdditionally, we will update the "),c("code",[e._v("CacheWrap")]),e._v(" and "),c("code",[e._v("CacheWrapper")]),e._v(" interfaces to enable listening in the caching layer.")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBNdWx0aVN0b3JlIGludGVyZmFjZSB7CgkuLi4KCgkvLyBMaXN0ZW5pbmdFbmFibGVkIHJldHVybnMgaWYgbGlzdGVuaW5nIGlzIGVuYWJsZWQgZm9yIHRoZSBLVlN0b3JlIGJlbG9uZ2luZyB0aGUgcHJvdmlkZWQgU3RvcmVLZXkKCUxpc3RlbmluZ0VuYWJsZWQoa2V5IFN0b3JlS2V5KSBib29sCgoJLy8gQWRkTGlzdGVuZXJzIGFkZHMgV3JpdGVMaXN0ZW5lcnMgZm9yIHRoZSBLVlN0b3JlIGJlbG9uZ2luZyB0byB0aGUgcHJvdmlkZWQgU3RvcmVLZXkKCS8vIEl0IGFwcGVuZHMgdGhlIGxpc3RlbmVycyB0byBhIGN1cnJlbnQgc2V0LCBpZiBvbmUgYWxyZWFkeSBleGlzdHMKCUFkZExpc3RlbmVycyhrZXkgU3RvcmVLZXksIGxpc3RlbmVycyBbXVdyaXRlTGlzdGVuZXIpCn0K"}}),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBDYWNoZVdyYXAgaW50ZXJmYWNlIHsKCS4uLgoKCS8vIENhY2hlV3JhcFdpdGhMaXN0ZW5lcnMgcmVjdXJzaXZlbHkgd3JhcHMgYWdhaW4gd2l0aCBsaXN0ZW5pbmcgZW5hYmxlZAoJQ2FjaGVXcmFwV2l0aExpc3RlbmVycyhzdG9yZUtleSB0eXBlcy5TdG9yZUtleSwgbGlzdGVuZXJzIFtdV3JpdGVMaXN0ZW5lcikgQ2FjaGVXcmFwCn0KCnR5cGUgQ2FjaGVXcmFwcGVyIGludGVyZmFjZSB7CgkuLi4KCgkvLyBDYWNoZVdyYXBXaXRoTGlzdGVuZXJzIHJlY3Vyc2l2ZWx5IHdyYXBzIGFnYWluIHdpdGggbGlzdGVuaW5nIGVuYWJsZWQKCUNhY2hlV3JhcFdpdGhMaXN0ZW5lcnMoc3RvcmVLZXkgdHlwZXMuU3RvcmVLZXksIGxpc3RlbmVycyBbXVdyaXRlTGlzdGVuZXIpIENhY2hlV3JhcAp9Cg=="}}),e._v(" "),c("h3",{attrs:{id:"multistore-implementation-updates"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#multistore-implementation-updates"}},[e._v("#")]),e._v(" MultiStore implementation updates")]),e._v(" "),c("p",[e._v("We will modify all of the "),c("code",[e._v("Store")]),e._v(" and "),c("code",[e._v("MultiStore")]),e._v(" implementations to satisfy these new interfaces, and adjust the "),c("code",[e._v("rootmulti")]),e._v(" "),c("code",[e._v("GetKVStore")]),e._v(" method\nto wrap the returned "),c("code",[e._v("KVStore")]),e._v(" with a "),c("code",[e._v("listenkv.Store")]),e._v(" if listening is turned on for that "),c("code",[e._v("Store")]),e._v(".")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAocnMgKlN0b3JlKSBHZXRLVlN0b3JlKGtleSB0eXBlcy5TdG9yZUtleSkgdHlwZXMuS1ZTdG9yZSB7CglzdG9yZSA6PSBycy5zdG9yZXNba2V5XS4odHlwZXMuS1ZTdG9yZSkKCglpZiBycy5UcmFjaW5nRW5hYmxlZCgpIHsKCQlzdG9yZSA9IHRyYWNla3YuTmV3U3RvcmUoc3RvcmUsIHJzLnRyYWNlV3JpdGVyLCBycy50cmFjZUNvbnRleHQpCgl9CglpZiBycy5MaXN0ZW5pbmdFbmFibGVkKGtleSkgewoJCXN0b3JlID0gbGlzdGVua3YuTmV3U3RvcmUoa2V5LCBzdG9yZSwgcnMubGlzdGVuZXJzW2tleV0pCgl9CgoJcmV0dXJuIHN0b3JlCn0K"}}),e._v(" "),c("p",[e._v("We will also adjust the "),c("code",[e._v("cachemulti")]),e._v(" constructor methods and the "),c("code",[e._v("rootmulti")]),e._v(" "),c("code",[e._v("CacheMultiStore")]),e._v(" method to forward the listeners\nto and enable listening in the cache layer.")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAocnMgKlN0b3JlKSBDYWNoZU11bHRpU3RvcmUoKSB0eXBlcy5DYWNoZU11bHRpU3RvcmUgewoJc3RvcmVzIDo9IG1ha2UobWFwW3R5cGVzLlN0b3JlS2V5XXR5cGVzLkNhY2hlV3JhcHBlcikKCWZvciBrLCB2IDo9IHJhbmdlIHJzLnN0b3JlcyB7CgkJc3RvcmVzW2tdID0gdgoJfQoJcmV0dXJuIGNhY2hlbXVsdGkuTmV3U3RvcmUocnMuZGIsIHN0b3JlcywgcnMua2V5c0J5TmFtZSwgcnMudHJhY2VXcml0ZXIsIHJzLnRyYWNlQ29udGV4dCwgcnMubGlzdGVuZXJzKQp9Cg=="}}),e._v(" "),c("h3",{attrs:{id:"exposing-the-data"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#exposing-the-data"}},[e._v("#")]),e._v(" Exposing the data")]),e._v(" "),c("p",[e._v("We will introduce a new "),c("code",[e._v("StreamingService")]),e._v(" interface for exposing "),c("code",[e._v("WriteListener")]),e._v(" data streams to external consumers.\nIn addition to streaming state changes as "),c("code",[e._v("StoreKVPair")]),e._v("s, the interface satisfies an "),c("code",[e._v("ABCIListener")]),e._v(" interface that plugs into the BaseApp\nand relays ABCI requests and responses so that the service can group the state changes with the ABCI requests that affected them and the ABCI responses they affected.")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQUJDSUxpc3RlbmVyIGludGVyZmFjZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgQUJDSSBtZXNzYWdlIHByb2Nlc3Npbmcgb2YgdGhlIEJhc2VBcHAKdHlwZSBBQkNJTGlzdGVuZXIgaW50ZXJmYWNlIHsKCS8vIExpc3RlbkJlZ2luQmxvY2sgdXBkYXRlcyB0aGUgc3RyZWFtaW5nIHNlcnZpY2Ugd2l0aCB0aGUgbGF0ZXN0IEJlZ2luQmxvY2sgbWVzc2FnZXMgCglMaXN0ZW5CZWdpbkJsb2NrKGN0eCB0eXBlcy5Db250ZXh0LCByZXEgYWJjaS5SZXF1ZXN0QmVnaW5CbG9jaywgcmVzIGFiY2kuUmVzcG9uc2VCZWdpbkJsb2NrKSBlcnJvciAKCS8vIExpc3RlbkVuZEJsb2NrIHVwZGF0ZXMgdGhlIHN0ZWFtaW5nIHNlcnZpY2Ugd2l0aCB0aGUgbGF0ZXN0IEVuZEJsb2NrIG1lc3NhZ2VzIAoJTGlzdGVuRW5kQmxvY2soY3R4IHR5cGVzLkNvbnRleHQsIHJlcSBhYmNpLlJlcXVlc3RFbmRCbG9jaywgcmVzIGFiY2kuUmVzcG9uc2VFbmRCbG9jaykgZXJyb3IgCgkvLyBMaXN0ZW5EZWxpdmVyVHggdXBkYXRlcyB0aGUgc3RlYW1pbmcgc2VydmljZSB3aXRoIHRoZSBsYXRlc3QgRGVsaXZlclR4IG1lc3NhZ2VzIAoJTGlzdGVuRGVsaXZlclR4KGN0eCB0eXBlcy5Db250ZXh0LCByZXEgYWJjaS5SZXF1ZXN0RGVsaXZlclR4LCByZXMgYWJjaS5SZXNwb25zZURlbGl2ZXJUeCkgZXJyb3IKfQoKLy8gU3RyZWFtaW5nU2VydmljZSBpbnRlcmZhY2UgZm9yIHJlZ2lzdGVyaW5nIFdyaXRlTGlzdGVuZXJzIHdpdGggdGhlIEJhc2VBcHAgYW5kIHVwZGF0aW5nIHRoZSBzZXJ2aWNlIHdpdGggdGhlIEFCQ0kgbWVzc2FnZXMgdXNpbmcgdGhlIGhvb2tzCnR5cGUgU3RyZWFtaW5nU2VydmljZSBpbnRlcmZhY2UgewoJLy8gU3RyZWFtIGlzIHRoZSBzdHJlYW1pbmcgc2VydmljZSBsb29wLCBhd2FpdHMga3YgcGFpcnMgYW5kIHdyaXRlcyB0aGVtIHRvIHNvbWUgZGVzdGluYXRpb24gc3RyZWFtIG9yIGZpbGUgCglTdHJlYW0od2cgKnN5bmMuV2FpdEdyb3VwKSBlcnJvcgoJLy8gTGlzdGVuZXJzIHJldHVybnMgdGhlIHN0cmVhbWluZyBzZXJ2aWNlJ3MgbGlzdGVuZXJzIGZvciB0aGUgQmFzZUFwcCB0byByZWdpc3RlciAKCUxpc3RlbmVycygpIG1hcFt0eXBlcy5TdG9yZUtleV1bXXN0b3JlLldyaXRlTGlzdGVuZXIgCgkvLyBBQkNJTGlzdGVuZXIgaW50ZXJmYWNlIGZvciBob29raW5nIGludG8gdGhlIEFCQ0kgbWVzc2FnZXMgZnJvbSBpbnNpZGUgdGhlIEJhc2VBcHAgCglBQkNJTGlzdGVuZXIgCgkvLyBDbG9zZXIgaW50ZXJmYWNlIAoJaW8uQ2xvc2VyCn0K"}}),e._v(" "),c("h4",{attrs:{id:"writing-state-changes-to-files"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#writing-state-changes-to-files"}},[e._v("#")]),e._v(" Writing state changes to files")]),e._v(" "),c("p",[e._v("We will introduce an implementation of "),c("code",[e._v("StreamingService")]),e._v(" which writes state changes out to files as length-prefixed protobuf encoded "),c("code",[e._v("StoreKVPair")]),e._v("s.\nThis service uses the same "),c("code",[e._v("StoreKVPairWriteListener")]),e._v(" for every KVStore, writing all the KV pairs from every KVStore\nout to the same files, relying on the "),c("code",[e._v("StoreKey")]),e._v(" field in the "),c("code",[e._v("StoreKVPair")]),e._v(" protobuf message to later distinguish the source for each pair.")]),e._v(" "),c("p",[e._v("Writing to a file is the simplest approach for streaming the data out to consumers.\nThis approach also provides the advantages of being persistent and durable, and the files can be read directly,\nor an auxiliary streaming services can read from the files and serve the data over a remote interface.")]),e._v(" "),c("h5",{attrs:{id:"encoding"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#encoding"}},[e._v("#")]),e._v(" Encoding")]),e._v(" "),c("p",[e._v("For each pair of "),c("code",[e._v("BeginBlock")]),e._v(" requests and responses, a file is created and named "),c("code",[e._v("block-{N}-begin")]),e._v(", where N is the block number.\nAt the head of this file the length-prefixed protobuf encoded "),c("code",[e._v("BeginBlock")]),e._v(" request is written.\nAt the tail of this file the length-prefixed protobuf encoded "),c("code",[e._v("BeginBlock")]),e._v(" response is written.\nIn between these two encoded messages, the state changes that occurred due to the "),c("code",[e._v("BeginBlock")]),e._v(" request are written chronologically as\na series of length-prefixed protobuf encoded "),c("code",[e._v("StoreKVPair")]),e._v("s representing "),c("code",[e._v("Set")]),e._v(" and "),c("code",[e._v("Delete")]),e._v(" operations within the KVStores the service\nis configured to listen to.")]),e._v(" "),c("p",[e._v("For each pair of "),c("code",[e._v("DeliverTx")]),e._v(" requests and responses, a file is created and named "),c("code",[e._v("block-{N}-tx-{M}")]),e._v(" where N is the block number and M\nis the tx number in the block (i.e. 0, 1, 2...).\nAt the head of this file the length-prefixed protobuf encoded "),c("code",[e._v("DeliverTx")]),e._v(" request is written.\nAt the tail of this file the length-prefixed protobuf encoded "),c("code",[e._v("DeliverTx")]),e._v(" response is written.\nIn between these two encoded messages, the state changes that occurred due to the "),c("code",[e._v("DeliverTx")]),e._v(" request are written chronologically as\na series of length-prefixed protobuf encoded "),c("code",[e._v("StoreKVPair")]),e._v("s representing "),c("code",[e._v("Set")]),e._v(" and "),c("code",[e._v("Delete")]),e._v(" operations within the KVStores the service\nis configured to listen to.")]),e._v(" "),c("p",[e._v("For each pair of "),c("code",[e._v("EndBlock")]),e._v(" requests and responses, a file is created and named "),c("code",[e._v("block-{N}-end")]),e._v(", where N is the block number.\nAt the head of this file the length-prefixed protobuf encoded "),c("code",[e._v("EndBlock")]),e._v(" request is written.\nAt the tail of this file the length-prefixed protobuf encoded "),c("code",[e._v("EndBlock")]),e._v(" response is written.\nIn between these two encoded messages, the state changes that occurred due to the "),c("code",[e._v("EndBlock")]),e._v(" request are written chronologically as\na series of length-prefixed protobuf encoded "),c("code",[e._v("StoreKVPair")]),e._v("s representing "),c("code",[e._v("Set")]),e._v(" and "),c("code",[e._v("Delete")]),e._v(" operations within the KVStores the service\nis configured to listen to.")]),e._v(" "),c("h5",{attrs:{id:"decoding"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#decoding"}},[e._v("#")]),e._v(" Decoding")]),e._v(" "),c("p",[e._v("To decode the files written in the above format we read all the bytes from a given file into memory and segment them into proto\nmessages based on the length-prefixing of each message. Once segmented, it is known that the first message is the ABCI request,\nthe last message is the ABCI response, and that every message in between is a "),c("code",[e._v("StoreKVPair")]),e._v(". This enables us to decode each segment into\nthe appropriate message type.")]),e._v(" "),c("p",[e._v("The type of ABCI req/res, the block height, and the transaction index (where relevant) is known\nfrom the file name, and the KVStore each "),c("code",[e._v("StoreKVPair")]),e._v(" originates from is known since the "),c("code",[e._v("StoreKey")]),e._v(" is included as a field in the proto message.")]),e._v(" "),c("h5",{attrs:{id:"implementation-example"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#implementation-example"}},[e._v("#")]),e._v(" Implementation example")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gRmlsZVN0cmVhbWluZ1NlcnZpY2UgaXMgYSBjb25jcmV0ZSBpbXBsZW1lbnRhdGlvbiBvZiBTdHJlYW1pbmdTZXJ2aWNlIHRoYXQgd3JpdGVzIHN0YXRlIGNoYW5nZXMgb3V0IHRvIGEgZmlsZQp0eXBlIEZpbGVTdHJlYW1pbmdTZXJ2aWNlIHN0cnVjdCB7CglsaXN0ZW5lcnMgbWFwW3Nkay5TdG9yZUtleV1bXXN0b3JlVHlwZXMuV3JpdGVMaXN0ZW5lciAvLyB0aGUgbGlzdGVuZXJzIHRoYXQgd2lsbCBiZSBpbml0aWFsaXplZCB3aXRoIEJhc2VBcHAKCXNyY0NoYW4gJmx0Oy1jaGFuIFtdYnl0ZSAvLyB0aGUgY2hhbm5lbCB0aGF0IGFsbCBvZiB0aGUgV3JpdGVMaXN0ZW5lcnMgd3JpdGUgdGhlaXIgZGF0YSBvdXQgdG8KCWZpbGVQcmVmaXggc3RyaW5nIC8vIG9wdGlvbmFsIHByZWZpeCBmb3IgZWFjaCBvZiB0aGUgZ2VuZXJhdGVkIGZpbGVzCgl3cml0ZURpciBzdHJpbmcgLy8gZGlyZWN0b3J5IHRvIHdyaXRlIGZpbGVzIGludG8KCWRzdEZpbGUgKm9zLkZpbGUgLy8gdGhlIGN1cnJlbnQgd3JpdGUgb3V0cHV0IGZpbGUKCW1hcnNoYWxsZXIgY29kZWMuQmluYXJ5Q29kZWMgLy8gbWFyc2hhbGxlciB1c2VkIGZvciByZS1tYXJzaGFsbGluZyB0aGUgQUJDSSBtZXNzYWdlcyB0byB3cml0ZSB0aGVtIG91dCB0byB0aGUgZGVzdGluYXRpb24gZmlsZXMKCXN0YXRlQ2FjaGUgW11bXWJ5dGUgLy8gY2FjaGUgdGhlIHByb3RvYnVmIGJpbmFyeSBlbmNvZGVkIFN0b3JlS1ZQYWlycyBpbiB0aGUgb3JkZXIgdGhleSBhcmUgcmVjZWl2ZWQKfQo="}}),e._v(" "),c("p",[e._v("This streaming service uses a single instance of a simple intermediate "),c("code",[e._v("io.Writer")]),e._v(" as the underlying "),c("code",[e._v("io.Writer")]),e._v(" for its single "),c("code",[e._v("StoreKVPairWriteListener")]),e._v(",\nIt collects KV pairs from every KVStore synchronously off of the same channel, caching them in the order they are received, and then writing\nthem out to a file generated in response to an ABCI message hook. Files are named as outlined above, with optional prefixes to avoid potential naming collisions\nacross separate instances.")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gaW50ZXJtZWRpYXRlV3JpdGVyIGlzIHVzZWQgc28gdGhhdCB3ZSBkbyBub3QgbmVlZCB0byB1cGRhdGUgdGhlIHVuZGVybHlpbmcgaW8uV3JpdGVyIGluc2lkZSB0aGUgU3RvcmVLVlBhaXJXcml0ZUxpc3RlbmVyCi8vIGV2ZXJ5dGltZSB3ZSBiZWdpbiB3cml0aW5nIHRvIGEgbmV3IGZpbGUKdHlwZSBpbnRlcm1lZGlhdGVXcml0ZXIgc3RydWN0IHsKCW91dENoYW4gY2hhbiAmbHQ7LVtdYnl0ZQp9CgovLyBOZXdJbnRlcm1lZGlhdGVXcml0ZXIgY3JlYXRlIGFuIGluc3RhbmNlIG9mIGFuIGludGVybWVkaWF0ZVdyaXRlciB0aGF0IHNlbmRzIHRvIHRoZSBwcm92aWRlZCBjaGFubmVsCmZ1bmMgTmV3SW50ZXJtZWRpYXRlV3JpdGVyKG91dENoYW4gY2hhbiAmbHQ7LVtdYnl0ZSkgKmludGVybWVkaWF0ZVdyaXRlciB7CglyZXR1cm4gJmFtcDtpbnRlcm1lZGlhdGVXcml0ZXJ7CgkJb3V0Q2hhbjogb3V0Q2hhbiwKCX0KfQoKLy8gV3JpdGUgc2F0aXNmaWVzIGlvLldyaXRlcgpmdW5jIChpdyAqaW50ZXJtZWRpYXRlV3JpdGVyKSBXcml0ZShiIFtdYnl0ZSkgKGludCwgZXJyb3IpIHsKCWl3Lm91dENoYW4gJmx0Oy0gYgoJcmV0dXJuIGxlbihiKSwgbmlsCn0KCi8vIE5ld0ZpbGVTdHJlYW1pbmdTZXJ2aWNlIGNyZWF0ZXMgYSBuZXcgRmlsZVN0cmVhbWluZ1NlcnZpY2UgZm9yIHRoZSBwcm92aWRlZCB3cml0ZURpciwgKG9wdGlvbmFsKSBmaWxlUHJlZml4LCBhbmQgc3RvcmVLZXlzCmZ1bmMgTmV3RmlsZVN0cmVhbWluZ1NlcnZpY2Uod3JpdGVEaXIsIGZpbGVQcmVmaXggc3RyaW5nLCBzdG9yZUtleXMgW11zZGsuU3RvcmVLZXksIG0gY29kZWMuQmluYXJ5Q29kZWMpICgqRmlsZVN0cmVhbWluZ1NlcnZpY2UsIGVycm9yKSB7CglsaXN0ZW5DaGFuIDo9IG1ha2UoY2hhbiBbXWJ5dGUsIDApCglpdyA6PSBOZXdJbnRlcm1lZGlhdGVXcml0ZXIobGlzdGVuQ2hhbikKCWxpc3RlbmVyIDo9IGxpc3Rlbi5OZXdTdG9yZUtWUGFpcldyaXRlTGlzdGVuZXIoaXcsIG0pCglsaXN0bmVycyA6PSBtYWtlKG1hcFtzZGsuU3RvcmVLZXldW11zdG9yZVR5cGVzLldyaXRlTGlzdGVuZXIsIGxlbihzdG9yZUtleXMpKQoJLy8gaW4gdGhpcyBjYXNlLCB3ZSBhcmUgdXNpbmcgdGhlIHNhbWUgbGlzdGVuZXIgZm9yIGVhY2ggU3RvcmUKCWZvciBfLCBrZXkgOj0gcmFuZ2Ugc3RvcmVLZXlzIHsKCQlsaXN0ZW5lcnNba2V5XSA9IGxpc3RlbmVyCgl9CgkvLyBjaGVjayB0aGF0IHRoZSB3cml0ZURpciBleGlzdHMgYW5kIGlzIHdyaXRlYWJsZSBzbyB0aGF0IHdlIGNhbiBjYXRjaCB0aGUgZXJyb3IgaGVyZSBhdCBpbml0aWFsaXphdGlvbiBpZiBpdCBpcyBub3QKCS8vIHdlIGRvbid0IG9wZW4gYSBkc3RGaWxlIHVudGlsIHdlIHJlY2VpdmUgb3VyIGZpcnN0IEFCQ0kgbWVzc2FnZQoJaWYgZXJyIDo9IGZpbGV1dGlsLklzRGlyV3JpdGVhYmxlKHdyaXRlRGlyKTsgZXJyICE9IG5pbCB7CgkJcmV0dXJuIG5pbCwgZXJyCgl9CglyZXR1cm4gJmFtcDtGaWxlU3RyZWFtaW5nU2VydmljZXsKCQlsaXN0ZW5lcnM6IGxpc3RlbmVycywKCQlzcmNDaGFuOiBsaXN0ZW5DaGFuLAoJCWZpbGVQcmVmaXg6IGZpbGVQcmVmaXgsCgkJd3JpdGVEaXI6IHdyaXRlRGlyLAoJCW1hcnNoYWxsZXI6IG0sCgkJc3RhdGVDYWNoZTogbWFrZShbXVtdYnl0ZSwgMCksCgl9LCBuaWwKfQoKLy8gTGlzdGVuZXJzIHJldHVybnMgdGhlIFN0cmVhbWluZ1NlcnZpY2UncyB1bmRlcmx5aW5nIFdyaXRlTGlzdGVuZXJzLCB1c2UgZm9yIHJlZ2lzdGVyaW5nIHRoZW0gd2l0aCB0aGUgQmFzZUFwcApmdW5jIChmc3MgKkZpbGVTdHJlYW1pbmdTZXJ2aWNlKSBMaXN0ZW5lcnMoKSBtYXBbc2RrLlN0b3JlS2V5XVtdc3RvcmVUeXBlcy5Xcml0ZUxpc3RlbmVyIHsKCXJldHVybiBmc3MubGlzdGVuZXJzCn0KCmZ1bmMgKGZzcyAqRmlsZVN0cmVhbWluZ1NlcnZpY2UpIExpc3RlbkJlZ2luQmxvY2soY3R4IHNkay5Db250ZXh0LCByZXEgYWJjaS5SZXF1ZXN0QmVnaW5CbG9jaywgcmVzIGFiY2kuUmVzcG9uc2VCZWdpbkJsb2NrKSB7CgkvLyBOT1RFOiB0aGlzIGNvdWxkIGVpdGhlciBiZSBkb25lIHN5bmNocm9ub3VzbHkgb3IgYXN5bmNocm9ub3VzbHkKCS8vIGNyZWF0ZSBhIG5ldyBmaWxlIHdpdGggdGhlIHJlcSBpbmZvIGFjY29yZGluZyB0byBuYW1pbmcgc2NoZW1hCgkvLyB3cml0ZSByZXEgdG8gZmlsZQoJLy8gd3JpdGUgYWxsIHN0YXRlIGNoYW5nZXMgY2FjaGVkIGZvciB0aGlzIHN0YWdlIHRvIGZpbGUKCS8vIHJlc2V0IGNhY2hlCgkvLyB3cml0ZSByZXMgdG8gZmlsZQoJLy8gY2xvc2UgZmlsZQp9CgpmdW5jIChmc3MgKkZpbGVTdHJlYW1pbmdTZXJ2aWNlKSBMaXN0ZW5FbmRCbG9jayhjdHggc2RrLkNvbnRleHQsIHJlcSBhYmNpLlJlcXVlc3RCZWdpbkJsb2NrLCByZXMgYWJjaS5SZXNwb25zZUJlZ2luQmxvY2spIHsKCS8vIE5PVEU6IHRoaXMgY291bGQgZWl0aGVyIGJlIGRvbmUgc3luY2hyb25vdXNseSBvciBhc3luY2hyb25vdXNseQoJLy8gY3JlYXRlIGEgbmV3IGZpbGUgd2l0aCB0aGUgcmVxIGluZm8gYWNjb3JkaW5nIHRvIG5hbWluZyBzY2hlbWEKCS8vIHdyaXRlIHJlcSB0byBmaWxlCgkvLyB3cml0ZSBhbGwgc3RhdGUgY2hhbmdlcyBjYWNoZWQgZm9yIHRoaXMgc3RhZ2UgdG8gZmlsZQoJLy8gcmVzZXQgY2FjaGUKCS8vIHdyaXRlIHJlcyB0byBmaWxlCgkvLyBjbG9zZSBmaWxlCn0KCmZ1bmMgKGZzcyAqRmlsZVN0cmVhbWluZ1NlcnZpY2UpIExpc3RlbkRlbGl2ZXJUeChjdHggc2RrLkNvbnRleHQsIHJlcSBhYmNpLlJlcXVlc3REZWxpdmVyVHgsIHJlcyBhYmNpLlJlc3BvbnNlRGVsaXZlclR4KSB7CgkvLyBOT1RFOiB0aGlzIGNvdWxkIGVpdGhlciBiZSBkb25lIHN5bmNocm9ub3VzbHkgb3IgYXN5bmNocm9ub3VzbHkKCS8vIGNyZWF0ZSBhIG5ldyBmaWxlIHdpdGggdGhlIHJlcSBpbmZvIGFjY29yZGluZyB0byBuYW1pbmcgc2NoZW1hCgkvLyBOT1RFOiBpZiB0aGUgdHggZmFpbGVkLCBoYW5kbGUgYWNjb3JkaW5nbHkKCS8vIHdyaXRlIHJlcSB0byBmaWxlCgkvLyB3cml0ZSBhbGwgc3RhdGUgY2hhbmdlcyBjYWNoZWQgZm9yIHRoaXMgc3RhZ2UgdG8gZmlsZQoJLy8gcmVzZXQgY2FjaGUKCS8vIHdyaXRlIHJlcyB0byBmaWxlCgkvLyBjbG9zZSBmaWxlCn0KCi8vIFN0cmVhbSBzcGlucyB1cCBhIGdvcm91dGluZSBzZWxlY3QgbG9vcCB3aGljaCBhd2FpdHMgbGVuZ3RoLXByZWZpeGVkIGJpbmFyeSBlbmNvZGVkIEtWIHBhaXJzIGFuZCBjYWNoZXMgdGhlbSBpbiB0aGUgb3JkZXIgdGhleSB3ZXJlIHJlY2VpdmVkCmZ1bmMgKGZzcyAqRmlsZVN0cmVhbWluZ1NlcnZpY2UpIFN0cmVhbSh3ZyAqc3luYy5XYWl0R3JvdXAsIHF1aXRDaGFuICZsdDstY2hhbiBzdHJ1Y3R7fSkgewoJd2cuQWRkKDEpCglnbyBmdW5jKCkgewoJCWRlZmVyIHdnLkRvbmUoKQoJCWZvciB7CgkJCXNlbGVjdCB7CgkJCWNhc2UgJmx0Oy1xdWl0Q2hhbjoKCQkJCXJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGJ5IDo9ICZsdDstZnNzLnNyY0NoYW46CiAgICAgICAgICAgICAgICAgICAgICAgIAlmc3Muc3RhdGVDYWNoZSA9IGFwcGVuZChmc3Muc3RhdGVDYWNoZSwgYnkpCgkJCX0KCQl9Cgl9KCkKfQo="}}),e._v(" "),c("h4",{attrs:{id:"auxiliary-streaming-service"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#auxiliary-streaming-service"}},[e._v("#")]),e._v(" Auxiliary streaming service")]),e._v(" "),c("p",[e._v("We will create a separate standalone process that reads and internally queues the state as it is written out to these files\nand serves the data over a gRPC API. This API will allow filtering of requested data, e.g. by block number, block/tx hash, ABCI message type,\nwhether a DeliverTx message failed or succeeded, etc. In addition to unary RPC endpoints this service will expose "),c("code",[e._v("stream")]),e._v(" RPC endpoints for realtime subscriptions.")]),e._v(" "),c("h4",{attrs:{id:"file-pruning"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#file-pruning"}},[e._v("#")]),e._v(" File pruning")]),e._v(" "),c("p",[e._v("Without pruning the number of files can grow indefinitely, this may need to be managed by\nthe developer in an application or even module-specific manner (e.g. log rotation).\nThe file naming schema facilitates pruning by block number and/or ABCI message.\nThe gRPC auxiliary streaming service introduced above will include an option to remove the files as it consumes their data.")]),e._v(" "),c("h3",{attrs:{id:"configuration"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[e._v("#")]),e._v(" Configuration")]),e._v(" "),c("p",[e._v("We will provide detailed documentation on how to configure a "),c("code",[e._v("FileStreamingService")]),e._v(" from within an app's "),c("code",[e._v("AppCreator")]),e._v(",\nusing the provided "),c("code",[e._v("AppOptions")]),e._v(" and TOML configuration fields.")]),e._v(" "),c("h4",{attrs:{id:"baseapp-registration"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#baseapp-registration"}},[e._v("#")]),e._v(" BaseApp registration")]),e._v(" "),c("p",[e._v("We will add a new method to the "),c("code",[e._v("BaseApp")]),e._v(" to enable the registration of "),c("code",[e._v("StreamingService")]),e._v("s:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gU2V0U3RyZWFtaW5nU2VydmljZSBpcyB1c2VkIHRvIHJlZ2lzdGVyIGEgc3RyZWFtaW5nIHNlcnZpY2Ugd2l0aCB0aGUgQmFzZUFwcApmdW5jIChhcHAgKkJhc2VBcHApIFNldFN0cmVhbWluZ1NlcnZpY2UocyBTdHJlYW1pbmdTZXJ2aWNlKSB7CgkvLyBzZXQgdGhlIGxpc3RlbmVycyBmb3IgZWFjaCBTdG9yZUtleQoJZm9yIGtleSwgbGlzIDo9IHJhbmdlIHMuTGlzdGVuZXJzKCkgewoJCWFwcC5jbXMuQWRkTGlzdGVuZXJzKGtleSwgbGlzKQoJfQoJLy8gcmVnaXN0ZXIgdGhlIHN0cmVhbWluZyBzZXJ2aWNlIGhvb2tzIHdpdGhpbiB0aGUgQmFzZUFwcAoJLy8gQmFzZUFwcCB3aWxsIHBhc3MgQmVnaW5CbG9jaywgRGVsaXZlclR4LCBhbmQgRW5kQmxvY2sgcmVxdWVzdHMgYW5kIHJlc3BvbnNlcyB0byB0aGUgc3RyZWFtaW5nIHNlcnZpY2VzIHRvIHVwZGF0ZSB0aGVpciBBQkNJIGNvbnRleHQgdXNpbmcgdGhlc2UgaG9va3MKCWFwcC5ob29rcyA9IGFwcGVuZChhcHAuaG9va3MsIHMpCn0K"}}),e._v(" "),c("p",[e._v("We will also modify the "),c("code",[e._v("BeginBlock")]),e._v(", "),c("code",[e._v("EndBlock")]),e._v(", and "),c("code",[e._v("DeliverTx")]),e._v(" methods to pass ABCI requests and responses to any streaming service hooks registered\nwith the "),c("code",[e._v("BaseApp")]),e._v(".")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoYXBwICpCYXNlQXBwKSBCZWdpbkJsb2NrKHJlcSBhYmNpLlJlcXVlc3RCZWdpbkJsb2NrKSAocmVzIGFiY2kuUmVzcG9uc2VCZWdpbkJsb2NrKSB7CgoJLi4uCgoJLy8gQ2FsbCB0aGUgc3RyZWFtaW5nIHNlcnZpY2UgaG9va3Mgd2l0aCB0aGUgQmVnaW5CbG9jayBtZXNzYWdlcwoJZm9yIF8sIGhvb2sgOj0gcmFuZ2UgYXBwLmhvb2tzIHsKCQlob29rLkxpc3RlbkJlZ2luQmxvY2soYXBwLmRlbGl2ZXJTdGF0ZS5jdHgsIHJlcSwgcmVzKQoJfQoKCXJldHVybiByZXMKfQo="}}),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoYXBwICpCYXNlQXBwKSBFbmRCbG9jayhyZXEgYWJjaS5SZXF1ZXN0RW5kQmxvY2spIChyZXMgYWJjaS5SZXNwb25zZUVuZEJsb2NrKSB7CgoJLi4uCgoJLy8gQ2FsbCB0aGUgc3RyZWFtaW5nIHNlcnZpY2UgaG9va3Mgd2l0aCB0aGUgRW5kQmxvY2sgbWVzc2FnZXMKCWZvciBfLCBob29rIDo9IHJhbmdlIGFwcC5ob29rcyB7CgkJaG9vay5MaXN0ZW5FbmRCbG9jayhhcHAuZGVsaXZlclN0YXRlLmN0eCwgcmVxLCByZXMpCgl9CgoJcmV0dXJuIHJlcwp9Cg=="}}),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoYXBwICpCYXNlQXBwKSBEZWxpdmVyVHgocmVxIGFiY2kuUmVxdWVzdERlbGl2ZXJUeCkgYWJjaS5SZXNwb25zZURlbGl2ZXJUeCB7CgoJLi4uCgoJZ0luZm8sIHJlc3VsdCwgZXJyIDo9IGFwcC5ydW5UeChydW5UeE1vZGVEZWxpdmVyLCByZXEuVHgpCglpZiBlcnIgIT0gbmlsIHsKCQlyZXN1bHRTdHIgPSAmcXVvdDtmYWlsZWQmcXVvdDsKCQlyZXMgOj0gc2RrZXJyb3JzLlJlc3BvbnNlRGVsaXZlclR4KGVyciwgZ0luZm8uR2FzV2FudGVkLCBnSW5mby5HYXNVc2VkLCBhcHAudHJhY2UpCgkJLy8gSWYgd2UgdGhyb3cgYW5kIGVycm9yLCBiZSBzdXJlIHRvIHN0aWxsIGNhbGwgdGhlIHN0cmVhbWluZyBzZXJ2aWNlJ3MgaG9vawoJCWZvciBfLCBob29rIDo9IHJhbmdlIGFwcC5ob29rcyB7CgkJCWhvb2suTGlzdGVuRGVsaXZlclR4KGFwcC5kZWxpdmVyU3RhdGUuY3R4LCByZXEsIHJlcykKCQl9CgkJcmV0dXJuIHJlcwoJfQoKCXJlcyA6PSBhYmNpLlJlc3BvbnNlRGVsaXZlclR4ewoJCUdhc1dhbnRlZDogaW50NjQoZ0luZm8uR2FzV2FudGVkKSwgLy8gVE9ETzogU2hvdWxkIHR5cGUgYWNjZXB0IHVuc2lnbmVkIGludHM/CgkJR2FzVXNlZDogICBpbnQ2NChnSW5mby5HYXNVc2VkKSwgICAvLyBUT0RPOiBTaG91bGQgdHlwZSBhY2NlcHQgdW5zaWduZWQgaW50cz8KCQlMb2c6ICAgICAgIHJlc3VsdC5Mb2csCgkJRGF0YTogICAgICByZXN1bHQuRGF0YSwKCQlFdmVudHM6ICAgIHNkay5NYXJrRXZlbnRzVG9JbmRleChyZXN1bHQuRXZlbnRzLCBhcHAuaW5kZXhFdmVudHMpLAoJfQoKCS8vIENhbGwgdGhlIHN0cmVhbWluZyBzZXJ2aWNlIGhvb2tzIHdpdGggdGhlIERlbGl2ZXJUeCBtZXNzYWdlcwoJZm9yIF8sIGhvb2sgOj0gcmFuZ2UgYXBwLmhvb2tzIHsKCQlob29rLkxpc3RlbkRlbGl2ZXJUeChhcHAuZGVsaXZlclN0YXRlLmN0eCwgcmVxLCByZXMpCgl9CgoJcmV0dXJuIHJlcwp9Cg=="}}),e._v(" "),c("h4",{attrs:{id:"toml-configuration"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#toml-configuration"}},[e._v("#")]),e._v(" TOML Configuration")]),e._v(" "),c("p",[e._v("We will provide standard TOML configuration options for configuring a "),c("code",[e._v("FileStreamingService")]),e._v(" for specific "),c("code",[e._v("Store")]),e._v("s.\nNote: the actual namespace is TBD.")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"toml",base64:"W3N0b3JlXQogICAgc3RyZWFtZXJzID0gWyAjIGlmIGxlbihzdHJlYW1lcnMpICZndDsgMCB3ZSBhcmUgc3RyZWFtaW5nCiAgICAgICAgJnF1b3Q7ZmlsZSZxdW90OywKICAgIF0KCltzdHJlYW1lcnNdCiAgICBbc3RyZWFtZXJzLmZpbGVdCiAgICAgICAga2V5cyA9IFsmcXVvdDtsaXN0JnF1b3Q7LCAmcXVvdDtvZiZxdW90OywgJnF1b3Q7c3RvcmUmcXVvdDssICZxdW90O2tleXMmcXVvdDssICZxdW90O3dlJnF1b3Q7LCAmcXVvdDt3YW50JnF1b3Q7LCAmcXVvdDt0byZxdW90OywgJnF1b3Q7ZXhwb3NlJnF1b3Q7LCAmcXVvdDtmb3ImcXVvdDssICZxdW90O3RoaXMmcXVvdDssICZxdW90O3N0cmVhbWluZyZxdW90OywgJnF1b3Q7c2VydmljZSZxdW90O10KICAgICAgICB3cml0ZV9kaXIgPSAmcXVvdDtwYXRoIHRvIHRoZSB3cml0ZSBkaXJlY3RvcnkmcXVvdDsKICAgICAgICBwcmVmaXggPSAmcXVvdDtvcHRpb25hbCBwcmVmaXggdG8gcHJlcGVuZCB0byB0aGUgZ2VuZXJhdGVkIGZpbGUgbmFtZXMmcXVvdDsK"}}),e._v(" "),c("p",[e._v("We will also provide a mapping of the TOML "),c("code",[e._v("store.streamers")]),e._v(' "file" configuration option to a helper functions for constructing the specified\nstreaming service. In the future, as other streaming services are added, their constructors will be added here as well.')]),e._v(" "),c("p",[e._v("Each configured streamer will receive the")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gU2VydmljZUNvbnN0cnVjdG9yIGlzIHVzZWQgdG8gY29uc3RydWN0IGEgc3RyZWFtaW5nIHNlcnZpY2UKdHlwZSBTZXJ2aWNlQ29uc3RydWN0b3IgZnVuYyhvcHRzIHNlcnZlclR5cGVzLkFwcE9wdGlvbnMsIGtleXMgW11zZGsuU3RvcmVLZXksIG1hcnNoYWxsZXIgY29kZWMuQmluYXJ5TWFyc2hhbGVyKSAoc2RrLlN0cmVhbWluZ1NlcnZpY2UsIGVycm9yKQoKLy8gU2VydmljZVR5cGUgZW51bSBmb3Igc3BlY2lmeWluZyB0aGUgdHlwZSBvZiBTdHJlYW1pbmdTZXJ2aWNlCnR5cGUgU2VydmljZVR5cGUgaW50Cgpjb25zdCAoCiAgVW5rbm93biBTZXJ2aWNlVHlwZSA9IGlvdGEKICBGaWxlCiAgLy8gYWRkIG1vcmUgaW4gdGhlIGZ1dHVyZQopCgovLyBOZXdTdHJlYW1pbmdTZXJ2aWNlVHlwZSByZXR1cm5zIHRoZSBzdHJlYW1pbmcuU2VydmljZVR5cGUgY29ycmVzcG9uZGluZyB0byB0aGUgcHJvdmlkZWQgbmFtZQpmdW5jIE5ld1N0cmVhbWluZ1NlcnZpY2VUeXBlKG5hbWUgc3RyaW5nKSBTZXJ2aWNlVHlwZSB7CiAgc3dpdGNoIHN0cmluZ3MuVG9Mb3dlcihuYW1lKSB7CiAgY2FzZSAmcXVvdDtmaWxlJnF1b3Q7LCAmcXVvdDtmJnF1b3Q7OgogICAgcmV0dXJuIEZpbGUKICBkZWZhdWx0OgogICAgcmV0dXJuIFVua25vd24KICB9Cn0KCi8vIFN0cmluZyByZXR1cm5zIHRoZSBzdHJpbmcgbmFtZSBvZiBhIHN0cmVhbWluZy5TZXJ2aWNlVHlwZQpmdW5jIChzc3QgU2VydmljZVR5cGUpIFN0cmluZygpIHN0cmluZyB7CiAgc3dpdGNoIHNzdCB7CiAgY2FzZSBGaWxlOgogICAgcmV0dXJuICZxdW90O2ZpbGUmcXVvdDsKICBkZWZhdWx0OgogICAgcmV0dXJuICZxdW90OyZxdW90OwogIH0KfQoKLy8gU2VydmljZUNvbnN0cnVjdG9yTG9va3VwVGFibGUgaXMgYSBtYXBwaW5nIG9mIHN0cmVhbWluZy5TZXJ2aWNlVHlwZXMgdG8gc3RyZWFtaW5nLlNlcnZpY2VDb25zdHJ1Y3RvcnMKdmFyIFNlcnZpY2VDb25zdHJ1Y3Rvckxvb2t1cFRhYmxlID0gbWFwW1NlcnZpY2VUeXBlXVNlcnZpY2VDb25zdHJ1Y3RvcnsKICBGaWxlOiBOZXdGaWxlU3RyZWFtaW5nU2VydmljZSwKfQoKLy8gU2VydmljZVR5cGVGcm9tU3RyaW5nIHJldHVybnMgdGhlIHN0cmVhbWluZy5TZXJ2aWNlQ29uc3RydWN0b3IgY29ycmVzcG9uZGluZyB0byB0aGUgcHJvdmlkZWQgbmFtZQpmdW5jIFNlcnZpY2VUeXBlRnJvbVN0cmluZyhuYW1lIHN0cmluZykgKFNlcnZpY2VDb25zdHJ1Y3RvciwgZXJyb3IpIHsKICBzc1R5cGUgOj0gTmV3U3RyZWFtaW5nU2VydmljZVR5cGUobmFtZSkKICBpZiBzc1R5cGUgPT0gVW5rbm93biB7CiAgICByZXR1cm4gbmlsLCBmbXQuRXJyb3JmKCZxdW90O3VucmVjb2duaXplZCBzdHJlYW1pbmcgc2VydmljZSBuYW1lICVzJnF1b3Q7LCBuYW1lKQogIH0KICBpZiBjb25zdHJ1Y3Rvciwgb2sgOj0gU2VydmljZUNvbnN0cnVjdG9yTG9va3VwVGFibGVbc3NUeXBlXTsgb2sgewogICAgcmV0dXJuIGNvbnN0cnVjdG9yLCBuaWwKICB9CiAgcmV0dXJuIG5pbCwgZm10LkVycm9yZigmcXVvdDtzdHJlYW1pbmcgc2VydmljZSBjb25zdHJ1Y3RvciBvZiB0eXBlICVzIG5vdCBmb3VuZCZxdW90Oywgc3NUeXBlLlN0cmluZygpKQp9CgovLyBOZXdGaWxlU3RyZWFtaW5nU2VydmljZSBpcyB0aGUgc3RyZWFtaW5nLlNlcnZpY2VDb25zdHJ1Y3RvciBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYSBGaWxlU3RyZWFtaW5nU2VydmljZQpmdW5jIE5ld0ZpbGVTdHJlYW1pbmdTZXJ2aWNlKG9wdHMgc2VydmVyVHlwZXMuQXBwT3B0aW9ucywga2V5cyBbXXNkay5TdG9yZUtleSwgbWFyc2hhbGxlciBjb2RlYy5CaW5hcnlNYXJzaGFsZXIpIChzZGsuU3RyZWFtaW5nU2VydmljZSwgZXJyb3IpIHsKICBmaWxlUHJlZml4IDo9IGNhc3QuVG9TdHJpbmcob3B0cy5HZXQoJnF1b3Q7c3RyZWFtZXJzLmZpbGUucHJlZml4JnF1b3Q7KSkKICBmaWxlRGlyIDo9IGNhc3QuVG9TdHJpbmcob3B0cy5HZXQoJnF1b3Q7c3RyZWFtZXJzLmZpbGUud3JpdGVfZGlyJnF1b3Q7KSkKICByZXR1cm4gZmlsZS5OZXdTdHJlYW1pbmdTZXJ2aWNlKGZpbGVEaXIsIGZpbGVQcmVmaXgsIGtleXMsIG1hcnNoYWxsZXIpCn0K"}}),e._v(" "),c("h4",{attrs:{id:"example-configuration"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#example-configuration"}},[e._v("#")]),e._v(" Example configuration")]),e._v(" "),c("p",[e._v("As a demonstration, we will implement the state watching features as part of SimApp.\nFor example, the below is a very rudimentary integration of the state listening features into the SimApp "),c("code",[e._v("AppCreator")]),e._v(" function:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBOZXdTaW1BcHAoCglsb2dnZXIgbG9nLkxvZ2dlciwgZGIgZGJtLkRCLCB0cmFjZVN0b3JlIGlvLldyaXRlciwgbG9hZExhdGVzdCBib29sLCBza2lwVXBncmFkZUhlaWdodHMgbWFwW2ludDY0XWJvb2wsCglob21lUGF0aCBzdHJpbmcsIGludkNoZWNrUGVyaW9kIHVpbnQsIGVuY29kaW5nQ29uZmlnIHNpbWFwcHBhcmFtcy5FbmNvZGluZ0NvbmZpZywKCWFwcE9wdHMgc2VydmVydHlwZXMuQXBwT3B0aW9ucywgYmFzZUFwcE9wdGlvbnMgLi4uZnVuYygqYmFzZWFwcC5CYXNlQXBwKSwKKSAqU2ltQXBwIHsKCgkuLi4KCglrZXlzIDo9IHNkay5OZXdLVlN0b3JlS2V5cygKCQlhdXRodHlwZXMuU3RvcmVLZXksIGJhbmt0eXBlcy5TdG9yZUtleSwgc3Rha2luZ3R5cGVzLlN0b3JlS2V5LAoJCW1pbnR0eXBlcy5TdG9yZUtleSwgZGlzdHJ0eXBlcy5TdG9yZUtleSwgc2xhc2hpbmd0eXBlcy5TdG9yZUtleSwKCQlnb3Z0eXBlcy5TdG9yZUtleSwgcGFyYW1zdHlwZXMuU3RvcmVLZXksIGliY2hvc3QuU3RvcmVLZXksIHVwZ3JhZGV0eXBlcy5TdG9yZUtleSwKCQlldmlkZW5jZXR5cGVzLlN0b3JlS2V5LCBpYmN0cmFuc2ZlcnR5cGVzLlN0b3JlS2V5LCBjYXBhYmlsaXR5dHlwZXMuU3RvcmVLZXksCgkpCgoJLy8gY29uZmlndXJlIHN0YXRlIGxpc3RlbmluZyBjYXBhYmlsaXRpZXMgdXNpbmcgQXBwT3B0aW9ucwoJbGlzdGVuZXJzIDo9IGNhc3QuVG9TdHJpbmdTbGljZShhcHBPcHRzLkdldCgmcXVvdDtzdG9yZS5zdHJlYW1lcnMmcXVvdDspKQoJZm9yIF8sIGxpc3RlbmVyTmFtZSA6PSByYW5nZSBsaXN0ZW5lcnMgewoJCS8vIGdldCB0aGUgc3RvcmUga2V5cyBhbGxvd2VkIHRvIGJlIGV4cG9zZWQgZm9yIHRoaXMgc3RyZWFtaW5nIHNlcnZpY2UgCgkJZXhwb3NlS2V5U3RycyA6PSBjYXN0LlRvU3RyaW5nU2xpY2UoYXBwT3B0cy5HZXQoZm10LlNwcmludGYoJnF1b3Q7c3RyZWFtZXJzLiVzLmtleXMmcXVvdDssIHN0cmVhbWVyTmFtZSkpKQoJCXZhciBleHBvc2VTdG9yZUtleXMgW11zZGsuU3RvcmVLZXkKCQlpZiBleHBvc2VBbGwoZXhwb3NlS2V5U3RycykgeyAvLyBpZiBsaXN0IGNvbnRhaW5zIGAqYCwgZXhwb3NlIGFsbCBTdG9yZUtleXMgCgkJCWV4cG9zZVN0b3JlS2V5cyA9IG1ha2UoW11zZGsuU3RvcmVLZXksIDAsIGxlbihrZXlzKSkKCQkJZm9yIF8sIHN0b3JlS2V5IDo9IHJhbmdlIGtleXMgewoJCQkJZXhwb3NlU3RvcmVLZXlzID0gYXBwZW5kKGV4cG9zZVN0b3JlS2V5cywgc3RvcmVLZXkpCgkJCX0KCQl9IGVsc2UgewoJCQlleHBvc2VTdG9yZUtleXMgPSBtYWtlKFtdc2RrLlN0b3JlS2V5LCAwLCBsZW4oZXhwb3NlS2V5U3RycykpCgkJCWZvciBfLCBrZXlTdHIgOj0gcmFuZ2UgZXhwb3NlS2V5U3RycyB7CgkJCQlpZiBzdG9yZUtleSwgb2sgOj0ga2V5c1trZXlTdHJdOyBvayB7CgkJCQkJZXhwb3NlU3RvcmVLZXlzID0gYXBwZW5kKGV4cG9zZVN0b3JlS2V5cywgc3RvcmVLZXkpCgkJCQl9CgkJCX0KCQl9CgkJaWYgbGVuKGV4cG9zZVN0b3JlS2V5cykgPT0gMCB7IC8vIHNob3J0IGNpcmN1aXQgaWYgd2UgYXJlIG5vdCBleHBvc2luZyBhbnl0aGluZyAKCQkJY29udGludWUKCQl9CgkJLy8gZ2V0IHRoZSBjb25zdHJ1Y3RvciBmb3IgdGhpcyBsaXN0ZW5lciBuYW1lCgkJY29uc3RydWN0b3IsIGVyciA6PSBiYXNlYXBwLk5ld1N0cmVhbWluZ1NlcnZpY2VDb25zdHJ1Y3RvcihsaXN0ZW5lck5hbWUpCgkJaWYgZXJyICE9IG5pbCB7CgkJCXRtb3MuRXhpdChlcnIuRXJyb3IoKSkgLy8gb3IgY29udGludWU/CgkJfQoJCS8vIGdlbmVyYXRlIHRoZSBzdHJlYW1pbmcgc2VydmljZSB1c2luZyB0aGUgY29uc3RydWN0b3IsIGFwcE9wdGlvbnMsIGFuZCB0aGUgU3RvcmVLZXlzIHdlIHdhbnQgdG8gZXhwb3NlCgkJc3RyZWFtaW5nU2VydmljZSwgZXJyIDo9IGNvbnN0cnVjdG9yKGFwcE9wdHMsIGV4cG9zZVN0b3JlS2V5cywgYXBwQ29kZWMpCgkJaWYgZXJyICE9IG5pbCB7CgkJCXRtb3MuRXhpdChlcnIuRXJyb3IoKSkKCQl9CgkJLy8gcmVnaXN0ZXIgdGhlIHN0cmVhbWluZyBzZXJ2aWNlIHdpdGggdGhlIEJhc2VBcHAKCQliQXBwLlJlZ2lzdGVyU3RyZWFtaW5nU2VydmljZShzdHJlYW1pbmdTZXJ2aWNlKQoJCS8vIHdhaXRncm91cCBhbmQgcXVpdCBjaGFubmVsIGZvciBvcHRpb25hbCBzaHV0ZG93biBjb29yZGluYXRpb24gb2YgdGhlIHN0cmVhbWluZyBzZXJ2aWNlCgkJd2cgOj0gbmV3KHN5bmMuV2FpdEdyb3VwKQoJCXF1aXRDaGFuIDo9IG1ha2UoY2hhbiBzdHJ1Y3R7fSkpCgkJLy8ga2ljayBvZmYgdGhlIGJhY2tncm91bmQgc3RyZWFtaW5nIHNlcnZpY2UgbG9vcAoJCXN0cmVhbWluZ1NlcnZpY2UuU3RyZWFtKHdnLCBxdWl0Q2hhbikgLy8gbWF5YmUgdGhpcyBzaG91bGQgYmUgZG9uZSBmcm9tIGluc2lkZSBCYXNlQXBwIGluc3RlYWQ/Cgl9CgoJLi4uCgoJcmV0dXJuIGFwcAp9Cg=="}}),e._v(" "),c("h2",{attrs:{id:"consequences"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#consequences"}},[e._v("#")]),e._v(" Consequences")]),e._v(" "),c("p",[e._v("These changes will provide a means of subscribing to KVStore state changes in real time.")]),e._v(" "),c("h3",{attrs:{id:"backwards-compatibility"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[e._v("#")]),e._v(" Backwards Compatibility")]),e._v(" "),c("ul",[c("li",[e._v("This ADR changes the "),c("code",[e._v("MultiStore")]),e._v(", "),c("code",[e._v("CacheWrap")]),e._v(", and "),c("code",[e._v("CacheWrapper")]),e._v(" interfaces, implementations supporting the previous version of these interfaces will not support the new ones")])]),e._v(" "),c("h3",{attrs:{id:"positive"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#positive"}},[e._v("#")]),e._v(" Positive")]),e._v(" "),c("ul",[c("li",[e._v("Ability to listen to KVStore state changes in real time and expose these events to external consumers")])]),e._v(" "),c("h3",{attrs:{id:"negative"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#negative"}},[e._v("#")]),e._v(" Negative")]),e._v(" "),c("ul",[c("li",[e._v("Changes "),c("code",[e._v("MultiStore")]),e._v(", "),c("code",[e._v("CacheWrap")]),e._v(", and "),c("code",[e._v("CacheWrapper")]),e._v(" interfaces")])]),e._v(" "),c("h3",{attrs:{id:"neutral"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#neutral"}},[e._v("#")]),e._v(" Neutral")]),e._v(" "),c("ul",[c("li",[e._v("Introduces additional- but optional- complexity to configuring and running a cosmos application")]),e._v(" "),c("li",[e._v("If an application developer opts to use these features to expose data, they need to be aware of the ramifications/risks of that data exposure as it pertains to the specifics of their application")])])],1)}),[],!1,null,null,null);l.default=t.exports}}]);