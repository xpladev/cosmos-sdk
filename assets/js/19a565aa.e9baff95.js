"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[8302],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>c});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(r),c=i,f=m["".concat(s,".").concat(c)]||m[c]||d[c]||a;return r?n.createElement(f,o(o({ref:t},u),{},{components:r})):n.createElement(f,o({ref:t},u))}));function c(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,o=new Array(a);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<a;p++)o[p]=r[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},7635:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var n=r(7462),i=(r(7294),r(3905));const a={sidebar_position:1},o="Query Services",l={unversionedId:"building-modules/query-services",id:"building-modules/query-services",title:"Query Services",description:"A Protobuf Query service processes queries. Query services are specific to the module in which they are defined, and only process queries defined within said module. They are called from BaseApp's Query method.",source:"@site/docs/building-modules/04-query-services.md",sourceDirName:"building-modules",slug:"/building-modules/query-services",permalink:"/main/building-modules/query-services",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"`Msg` Services",permalink:"/main/building-modules/msg-services"},next:{title:"BeginBlocker and EndBlocker",permalink:"/main/building-modules/beginblock-endblock"}},s={},p=[{value:"<code>Querier</code> type",id:"querier-type",level:2},{value:"Implementation of a module query service",id:"implementation-of-a-module-query-service",level:2},{value:"gRPC Service",id:"grpc-service",level:3}],u={toc:p};function d(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"query-services"},"Query Services"),(0,i.kt)("admonition",{title:"Synopsis",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"A Protobuf Query service processes ",(0,i.kt)("a",{parentName:"p",href:"/main/building-modules/messages-and-queries#queries"},(0,i.kt)("inlineCode",{parentName:"a"},"queries")),". Query services are specific to the module in which they are defined, and only process ",(0,i.kt)("inlineCode",{parentName:"p"},"queries")," defined within said module. They are called from ",(0,i.kt)("inlineCode",{parentName:"p"},"BaseApp"),"'s ",(0,i.kt)("a",{parentName:"p",href:"/main/core/baseapp#query"},(0,i.kt)("inlineCode",{parentName:"a"},"Query")," method"),".")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("h3",{parentName:"admonition",id:"pre-requisite-readings"},"Pre-requisite Readings"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/main/building-modules/module-manager"},"Module Manager")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/main/building-modules/messages-and-queries"},"Messages and Queries")))),(0,i.kt)("h2",{id:"querier-type"},(0,i.kt)("inlineCode",{parentName:"h2"},"Querier")," type"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"querier")," type defined in the Cosmos SDK will be deprecated in favor of ",(0,i.kt)("a",{parentName:"p",href:"#grpc-service"},"gRPC Services"),". It specifies the typical structure of a ",(0,i.kt)("inlineCode",{parentName:"p"},"querier")," function:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.46.0/types/queryable.go#L9\n")),(0,i.kt)("p",null,"Let us break it down:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("a",{parentName:"li",href:"/main/core/context"},(0,i.kt)("inlineCode",{parentName:"a"},"Context"))," contains all the necessary information needed to process the ",(0,i.kt)("inlineCode",{parentName:"li"},"query"),", as well as a branch of the latest state. It is primarily used by the ",(0,i.kt)("a",{parentName:"li",href:"/main/building-modules/keeper"},(0,i.kt)("inlineCode",{parentName:"a"},"keeper"))," to access the state."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"path")," is an array of ",(0,i.kt)("inlineCode",{parentName:"li"},"string"),"s that contains the type of the query, and that can also contain ",(0,i.kt)("inlineCode",{parentName:"li"},"query")," arguments. See ",(0,i.kt)("a",{parentName:"li",href:"/main/building-modules/messages-and-queries#queries"},(0,i.kt)("inlineCode",{parentName:"a"},"queries"))," for more information."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"req")," itself is primarily used to retrieve arguments if they are too large to fit in the ",(0,i.kt)("inlineCode",{parentName:"li"},"path"),". This is done using the ",(0,i.kt)("inlineCode",{parentName:"li"},"Data")," field of ",(0,i.kt)("inlineCode",{parentName:"li"},"req"),"."),(0,i.kt)("li",{parentName:"ul"},"The result in ",(0,i.kt)("inlineCode",{parentName:"li"},"[]byte")," returned to ",(0,i.kt)("inlineCode",{parentName:"li"},"BaseApp"),", marshalled using the application's ",(0,i.kt)("a",{parentName:"li",href:"/main/core/encoding"},(0,i.kt)("inlineCode",{parentName:"a"},"codec")),".")),(0,i.kt)("h2",{id:"implementation-of-a-module-query-service"},"Implementation of a module query service"),(0,i.kt)("h3",{id:"grpc-service"},"gRPC Service"),(0,i.kt)("p",null,"When defining a Protobuf ",(0,i.kt)("inlineCode",{parentName:"p"},"Query")," service, a ",(0,i.kt)("inlineCode",{parentName:"p"},"QueryServer")," interface is generated for each module with all the service methods:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"type QueryServer interface {\n    QueryBalance(context.Context, *QueryBalanceParams) (*types.Coin, error)\n    QueryAllBalances(context.Context, *QueryAllBalancesParams) (*QueryAllBalancesResponse, error)\n}\n")),(0,i.kt)("p",null,"These custom queries methods should be implemented by a module's keeper, typically in ",(0,i.kt)("inlineCode",{parentName:"p"},"./keeper/grpc_query.go"),". The first parameter of these methods is a generic ",(0,i.kt)("inlineCode",{parentName:"p"},"context.Context"),", whereas querier methods generally need an instance of ",(0,i.kt)("inlineCode",{parentName:"p"},"sdk.Context")," to read\nfrom the store. Therefore, the Cosmos SDK provides a function ",(0,i.kt)("inlineCode",{parentName:"p"},"sdk.UnwrapSDKContext")," to retrieve the ",(0,i.kt)("inlineCode",{parentName:"p"},"sdk.Context")," from the provided\n",(0,i.kt)("inlineCode",{parentName:"p"},"context.Context"),"."),(0,i.kt)("p",null,"Here's an example implementation for the bank module:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.46.0/x/bank/keeper/grpc_query.go\n")))}d.isMDXComponent=!0}}]);